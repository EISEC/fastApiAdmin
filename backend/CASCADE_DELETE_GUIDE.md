# üóëÔ∏è –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∫–∞—Å–∫–∞–¥–Ω–æ–º—É —É–¥–∞–ª–µ–Ω–∏—é —Å–∞–π—Ç–æ–≤

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —Å–∞–π—Ç–æ–≤ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏ –ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** —Å–∞–π—Ç–∞ –≤–º–µ—Å—Ç–µ —Å–æ –≤—Å–µ–º–∏ –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏. –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–∞–π—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è:

- ‚úÖ **–í—Å–µ –ø–æ—Å—Ç—ã** —Å–∞–π—Ç–∞
- ‚úÖ **–í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã** —Å–∞–π—Ç–∞  
- ‚úÖ **–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏** —Å–∞–π—Ç–∞
- ‚úÖ **–í—Å–µ —Ç–µ–≥–∏** —Å–∞–π—Ç–∞
- ‚úÖ **–í—Å–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –º–æ–¥–µ–ª–∏** —Å–∞–π—Ç–∞
- ‚úÖ **–°–≤—è–∑–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏** (assigned_users)
- ‚úÖ **–§–∞–π–ª—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** —Å–∞–π—Ç–∞

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### üìä –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CASCADE –≤ –º–æ–¥–µ–ª—è—Ö:

```python
# ‚úÖ –£–ñ–ï –ù–ê–°–¢–†–û–ï–ù–û: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
Post.site ‚Üí on_delete=models.CASCADE
Category.site ‚Üí on_delete=models.CASCADE  
Tag.site ‚Üí on_delete=models.CASCADE
Page.site ‚Üí on_delete=models.CASCADE
DynamicModel.site ‚Üí on_delete=models.CASCADE

# ‚ö†Ô∏è –ó–ê–©–ò–©–ï–ù–û: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è
CustomUser.site ‚Üí on_delete=models.SET_NULL
```

### üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

1. **–°–∏–≥–Ω–∞–ª—ã Django** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—á–∏—Å—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤
2. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π (–æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ)
3. **API endpoints** - —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ REST API
4. **Management –∫–æ–º–∞–Ω–¥–∞** - —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å

---

## üöÄ –°–ø–æ—Å–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. üåê –ß–µ—Ä–µ–∑ API (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è frontend)

#### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —É–¥–∞–ª–µ–Ω–∏—è:
```bash
GET /api/sites/{id}/delete_preview/
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "site_info": {
    "name": "–ú–æ–π —Å–∞–π—Ç",
    "domain": "example.com",
    "owner": "admin",
    "created_at": "2024-01-01T00:00:00Z",
    "is_active": true
  },
  "to_be_deleted": {
    "posts": 25,
    "pages": 8,
    "categories": 5,
    "tags": 15,
    "dynamic_models": 2
  },
  "users_affected": {
    "assigned_users": 3,
    "assigned_users_list": [
      {"id": 1, "username": "author1", "email": "author1@example.com"},
      {"id": 2, "username": "author2", "email": "author2@example.com"}
    ]
  },
  "warnings": [
    "–ë–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (55 –æ–±—ä–µ–∫—Ç–æ–≤)",
    "3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—Ç–µ—Ä—è—é—Ç –¥–æ—Å—Ç—É–ø"
  ]
}
```

#### –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:
```bash
DELETE /api/sites/{id}/cascade_delete/
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "message": "–°–∞–π—Ç \"–ú–æ–π —Å–∞–π—Ç\" —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω —Å–æ –≤—Å–µ–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏",
  "deleted_stats": {
    "posts": 25,
    "pages": 8,
    "categories": 5,
    "tags": 15,
    "dynamic_models": 2,
    "assigned_users_cleared": 3
  }
}
```

### 2. üíª –ß–µ—Ä–µ–∑ Management –∫–æ–º–∞–Ω–¥—É

#### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä:
```bash
python3 manage.py delete_site_cascade 1 --dry-run
```

**–í—ã–≤–æ–¥:**
```
üìã –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –°–ê–ô–¢–ï:
   –ù–∞–∑–≤–∞–Ω–∏–µ: –ú–æ–π —Å–∞–π—Ç
   –î–æ–º–µ–Ω: example.com
   –í–ª–∞–¥–µ–ª–µ—Ü: admin

üóëÔ∏è  –ë–£–î–ï–¢ –£–î–ê–õ–ï–ù–û:
   üìù –ü–æ—Å—Ç–æ–≤: 25
   üìÑ –°—Ç—Ä–∞–Ω–∏—Ü: 8
   üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–π: 5
   üè∑Ô∏è  –¢–µ–≥–æ–≤: 15
   üîß –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π: 2
   üë• –ë—É–¥–µ—Ç –æ—á–∏—â–µ–Ω–æ —Å–≤—è–∑–µ–π —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏: 3

   üìä –í–°–ï–ì–û –û–ë–™–ï–ö–¢–û–í: 55

‚úÖ Dry-run —Ä–µ–∂–∏–º: –Ω–∏—á–µ–≥–æ –Ω–µ —É–¥–∞–ª–µ–Ω–æ
```

#### –£–¥–∞–ª–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º:
```bash
python3 manage.py delete_site_cascade 1
```

#### –£–¥–∞–ª–µ–Ω–∏–µ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:
```bash
python3 manage.py delete_site_cascade 1 --force
```

### 3. üêç –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ —á–µ—Ä–µ–∑ Python

```python
from apps.sites.signals import cascade_delete_site_with_transaction

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
result = cascade_delete_site_with_transaction(site_id=1)

if result['success']:
    print(f"–£–¥–∞–ª–µ–Ω —Å–∞–π—Ç: {result['site_name']}")
    print(f"–£–¥–∞–ª–µ–Ω–æ –ø–æ—Å—Ç–æ–≤: {result['posts_deleted']}")
    print(f"–£–¥–∞–ª–µ–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü: {result['pages_deleted']}")
else:
    print(f"–û—à–∏–±–∫–∞: {result['error']}")
```

### 4. üîß –û–±—ã—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Django ORM

```python
# –ü—Ä–æ—Å—Ç–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (—Ç–∞–∫–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞—Å–∫–∞–¥–Ω–æ –±–ª–∞–≥–æ–¥–∞—Ä—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º)
site = Site.objects.get(id=1)
site.delete()  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è

### –ö—Ç–æ –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Å–∞–π—Ç—ã:

- ‚úÖ **–°—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** - –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –ª—é–±–æ–π —Å–∞–π—Ç
- ‚úÖ **–í–ª–∞–¥–µ–ª–µ—Ü —Å–∞–π—Ç–∞** - –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Å–∞–π—Ç—ã
- ‚ùå **–ê–≤—Ç–æ—Ä—ã** - –ù–ï –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å —Å–∞–π—Ç—ã
- ‚ùå **–û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** - –ù–ï –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å —Å–∞–π—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

```python
# API –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞
if user_role not in [Role.SUPERUSER] and site.owner != request.user:
    return Response({'error': '–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —ç—Ç–æ–≥–æ —Å–∞–π—Ç–∞'}, 
                   status=403)
```

---

## ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### üö® –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:

1. **–ë–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞** (>50 –æ–±—ä–µ–∫—Ç–æ–≤)
2. **–ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** –ø–æ—Ç–µ—Ä—è—é—Ç –¥–æ—Å—Ç—É–ø
3. **–ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–∞–π—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞** - –≤–ª–∞–¥–µ–ª–µ—Ü –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –±–µ–∑ —Å–∞–π—Ç–æ–≤

### üõ°Ô∏è –ó–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã:

1. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
3. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ** - —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–≤–æ–¥ 'DELETE'
4. **Dry-run —Ä–µ–∂–∏–º** - –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä

### ‚ùå –ß—Ç–æ –ù–ï —É–¥–∞–ª—è–µ—Ç—Å—è:

- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** - –æ—Å—Ç–∞—é—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ (—Å–≤—è–∑—å site –æ–±–Ω—É–ª—è–µ—Ç—Å—è)
- **–†–æ–ª–∏** - –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ä–æ–ª–∏ –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç—Å—è
- **–õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã** - —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:

```bash
# –í development
tail -f logs/django.log | grep "—É–¥–∞–ª–µ–Ω–∏–µ —Å–∞–π—Ç–∞"

# –í production 
grep "cascade_delete" /var/log/django/app.log
```

### –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤:

```
INFO –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —É–¥–∞–ª–µ–Ω–∏–µ —Å–∞–π—Ç–∞: –ú–æ–π —Å–∞–π—Ç (ID: 1)
INFO –ë—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã —Å–≤—è–∑–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã: {'posts': 25, 'pages': 8, 'categories': 5, 'tags': 15, 'dynamic_models': 2}
INFO –û—á–∏—â–∞–µ–º —Å–≤—è–∑–∏ —Å 3 –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
WARNING –£–¥–∞–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–∞–π—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è admin. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –±–µ–∑ —Å–∞–π—Ç–æ–≤.
INFO –°–∞–π—Ç —É–¥–∞–ª–µ–Ω: –ú–æ–π —Å–∞–π—Ç (ID: 1)
INFO –£–¥–∞–ª–µ–Ω—ã —Ñ–∞–π–ª—ã: ['/media/sites/icons/icon.jpg', '/media/sites/main/hero.jpg']
INFO –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–∞–π—Ç–∞ –ú–æ–π —Å–∞–π—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:

```bash
# –¢–µ—Å—Ç—ã –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
python3 manage.py test apps.sites.tests_cascade_delete -v 2

# –í—Å–µ —Ç–µ—Å—Ç—ã —Å–∞–π—Ç–æ–≤
python3 manage.py test apps.sites -v 2
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:

- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ —Å–≤—è–∑–µ–π M2M —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏  
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (SET_NULL)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –æ—Ç–∫–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —Å–∞–π—Ç–æ–≤
- ‚úÖ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ–±—ã—á–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º

---

## üöÄ Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### React/TypeScript –ø—Ä–∏–º–µ—Ä:

```typescript
import { sitesStore } from '../store/sitesStore';

// –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
const previewDelete = async (siteId: number) => {
  const preview = await sitesStore.getDeletePreview(siteId);
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  if (preview.warnings.length > 0) {
    setWarnings(preview.warnings);
  }
  
  setDeleteStats(preview.to_be_deleted);
  setAffectedUsers(preview.users_affected.assigned_users_list);
};

// –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
const cascadeDelete = async (siteId: number) => {
  try {
    const result = await sitesStore.cascadeDelete(siteId);
    
    showSuccess(`–°–∞–π—Ç —É–¥–∞–ª–µ–Ω. –£–¥–∞–ª–µ–Ω–æ –æ–±—ä–µ–∫—Ç–æ–≤: ${
      Object.values(result.deleted_stats).reduce((a, b) => a + b, 0)
    }`);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–∞–π—Ç–æ–≤
    await sitesStore.fetchSites();
    
  } catch (error) {
    showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–∞–π—Ç–∞');
  }
};
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:

```tsx
const DeleteSiteModal = ({ site, onConfirm, onCancel }) => {
  const [preview, setPreview] = useState(null);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    if (site) {
      loadPreview();
    }
  }, [site]);

  const loadPreview = async () => {
    const data = await sitesStore.getDeletePreview(site.id);
    setPreview(data);
  };

  const handleConfirm = async () => {
    setLoading(true);
    await onConfirm(site.id);
    setLoading(false);
  };

  if (!preview) return <Spinner />;

  return (
    <Modal>
      <div className="p-6">
        <h2 className="text-xl font-bold text-red-600 mb-4">
          ‚ö†Ô∏è –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–∞–π—Ç–∞
        </h2>
        
        <div className="mb-4">
          <p><strong>–°–∞–π—Ç:</strong> {preview.site_info.name}</p>
          <p><strong>–î–æ–º–µ–Ω:</strong> {preview.site_info.domain}</p>
        </div>

        <div className="bg-red-50 p-4 rounded mb-4">
          <h3 className="font-semibold mb-2">–ë—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ:</h3>
          <ul className="space-y-1">
            <li>üìù –ü–æ—Å—Ç–æ–≤: {preview.to_be_deleted.posts}</li>
            <li>üìÑ –°—Ç—Ä–∞–Ω–∏—Ü: {preview.to_be_deleted.pages}</li>
            <li>üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–π: {preview.to_be_deleted.categories}</li>
            <li>üè∑Ô∏è –¢–µ–≥–æ–≤: {preview.to_be_deleted.tags}</li>
            <li>üîß –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π: {preview.to_be_deleted.dynamic_models}</li>
          </ul>
        </div>

        {preview.warnings.length > 0 && (
          <div className="bg-yellow-50 p-4 rounded mb-4">
            <h3 className="font-semibold mb-2">‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:</h3>
            <ul className="space-y-1">
              {preview.warnings.map((warning, index) => (
                <li key={index} className="text-yellow-800">{warning}</li>
              ))}
            </ul>
          </div>
        )}

        <div className="flex gap-3">
          <button
            onClick={handleConfirm}
            disabled={loading}
            className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700"
          >
            {loading ? '–£–¥–∞–ª–µ–Ω–∏–µ...' : '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ'}
          </button>
          <button
            onClick={onCancel}
            className="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400"
          >
            –û—Ç–º–µ–Ω–∞
          </button>
        </div>
      </div>
    </Modal>
  );
};
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –§–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã:

- `backend/apps/sites/signals.py` - –°–∏–≥–Ω–∞–ª—ã –∏ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
- `backend/apps/sites/views.py` - API endpoints
- `backend/apps/sites/management/commands/delete_site_cascade.py` - Management –∫–æ–º–∞–Ω–¥–∞
- `backend/apps/sites/tests_cascade_delete.py` - –¢–µ—Å—Ç—ã

### –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:

- `COMPONENTS.md` - –û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –∏ —Å–≤—è–∑–µ–π
- `API_SUMMARY.md` - –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ API endpoints  
- `TROUBLESHOOTING.md` - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

---

## ‚ùì FAQ

**Q: –ú–æ–∂–Ω–æ –ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–∞–π—Ç?**
A: –ù–µ—Ç, –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ dry-run –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.

**Q: –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å —Ñ–∞–π–ª–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?**
A: –í—Å–µ —Ñ–∞–π–ª—ã —Å–∞–π—Ç–∞ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, uploads) —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ —Å–∏–≥–Ω–∞–ª—ã.

**Q: –ú–æ–∂–Ω–æ –ª–∏ —É–¥–∞–ª–∏—Ç—å —Å–∞–π—Ç —á–∞—Å—Ç–∏—á–Ω–æ?**
A: –ù–µ—Ç, —Å–∏—Å—Ç–µ–º–∞ —É–¥–∞–ª—è–µ—Ç —Å–∞–π—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é. –î–ª—è —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏.

**Q: –ß—Ç–æ –µ—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–µ—Ä–≤–µ—Ç—Å—è?**
A: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–∞—Ç–∏—Ç—Å—è, –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º–∏.

**Q: –ö–∞–∫ —É–¥–∞–ª–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∞–π—Ç–æ–≤ —Å—Ä–∞–∑—É?**
A: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ü–∏–∫–ª —Å `cascade_delete_site_with_transaction()` –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ bulk –æ–ø–µ—Ä–∞—Ü–∏—é.

---

> ‚ö†Ô∏è **–í–ê–ñ–ù–û:** –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ! –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--dry-run` –∏–ª–∏ API –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª—å–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º. 